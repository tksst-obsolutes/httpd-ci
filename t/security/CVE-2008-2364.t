use strict;
use warnings FATAL => 'all';

use Apache::Test;
use Apache::TestRequest;
use Apache::TestUtil;
use Apache::TestConfig ();

plan tests => 3, need_module 'proxy';

Apache::TestRequest::module("proxy_http_reverse");
Apache::TestRequest::user_agent(requests_redirectable => 0);

my $r = GET("/reverse/");
ok t_cmp($r->code, 200, "reverse proxy to index.html");

if (have_cgi) {
    $r = GET("/reverse/modules/cgi/nph-interim1.pl");
    ok t_cmp($r->code, 200, "small number of interim responses - CVE-2008-2364");

    $r = GET("/reverse/modules/cgi/nph-interim2.pl");
    ok t_cmp($r->code, 502, "large number of interim responses - CVE-2008-2364");

} else {
    skip "skipping tests without CGI module" foreach (1..2);
}

